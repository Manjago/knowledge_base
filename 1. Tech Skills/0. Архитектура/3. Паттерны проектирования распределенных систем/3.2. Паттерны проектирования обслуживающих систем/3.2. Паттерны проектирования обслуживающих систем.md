# Паттерны проектирования обслуживающих систем
## Реплицированные сервисы с распределением нагрузки
### Сервисы без внутреннего состояния
Сервисы без внутреннего состояния (stateless) не требуют для своей работы сохранения состояния.<br/>
Системы не хранящие состояние, реплицируются для обеспечения избыточности и масштабируемости.<br/>
Горизонтально масштабируемые системы поддерживают растущее количество пользователей путем добавления дополнительных копий сервиса<br/>
При этом, балансировщик нагрузки не только равномерно распределяет нагрузку, но и предоставляет общее сетевое имя<br/>
В кубернетес, балансировщик можно сделать с помощью объекта `Service`<br/>
![Общая схема](img/stateless_general.png)<br/>
_Бёрнс Б., Распределенные системы. Паттерны проектирования. Стр. 82-83_

### Сервисы с закреплением сессии
Часто лучше обеспечить направление запроса конкретного пользователя определенному экземпляру сервиса<br/>
Иногда это может быть обусловлено кешированием пользовательских данных<br/>
Закрепление сессий обычно реализуется путем хеширования IP-адресов клиента и сервера<br/> 
![Общая схема](img/stateful_general.png)<br/>
_Бёрнс Б., Распределенные системы. Паттерны проектирования. Стр. 87-89_

### Кэширование
В простом виде, для http, кэширующий прокси представляет собой обычный HTTP-сервер, хранящий в памяти состояние запросов пользователей.<br/>
Если два пользователя запросят одну и ту же web-страницу, только один запрос будет адресован приложению, а второй будет обслужен из памяти кэша.<br/>
К примеру, если приложение выполняет сложную обработку, и визуализацию данных, нэш не помешает.<br/>
Вариант релазиации - [varnish-cache](http://varnish-cache.org/)<br/>
_Бёрнс Б., Распределенные системы. Паттерны проектирования. Стр. 90_

## Шардированные сервисы
В отличие от реплицированных сервисов каждая *копия шардированного сервиса (шард)* может обслужить только часть запросов<br/>
*Узаел балансировки нагрузки (корневой узел)* отвечает за изучение каждого запроса и перенаправление его соответствующему узлу (или узлам) для обработки<br/>
Если репликация сервиса обычно используется для построения stateless-сервисов, то шардирование - для сервисов, хранящих состояние (stateful)<br/>
_Бёрнс Б., Распределенные системы. Паттерны проектирования. Стр. 102_

