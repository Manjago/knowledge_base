# MongoDB
## О MongoDB и версиях
MongoDB - это система управления базами данных, "заточенная" под веб-приложения и инфраструктуру Интернета.<br/>
Модель данных и стратегия их постоянного хранения спроектированы для достижения высокой пропускной способности чтения и записи и обеспечивает простую масштабируемость  с автоматическим переходом на резервный ресурс в случае отказа<br/>
Написини на С++ и распространяется под лицензией GNU-AGPL<br/>
Четные номера версий - стабильные, а нечетные - разрабатываемые<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 23, 36, 37_

## Преимущество NoSQL перед SQL
Отсутствие предопределенной схемы несет с собой некоторые преимущества:
1. Структуру данных определяет приложение, а не база. В том числе, то позволяет ускорить разработку на ранних этапах
1. безсхеная модель позволяет представить данные с переменным набором свойств

_Кайл Бенкер. MongoDB в действии. Стр. 28_

## Произвольные запросы к БД
Что касается реляционной базы данных, она обладает таким свойством и выполнит любой SQL-запрос, сколько бы условийон ни содержал<br/>
При проектировании MongoDB в частности ставилась задача по возможности сохранить выразительную мощь запросов, которая считается принципиально важной особенностью СУБД<br/>
Пример запрос в MongoDB выглядит так
```js
db.posts.find({'tags': 'politics', 'vote_count': {'$gt': 10}});
```
К примеру, в key-value базах данных, можно делать запрос только по первичному ключу
_Кайл Бенкер. MongoDB в действии. Стр. 28-30_

## Индексы в MongoDB
В MongoDB, вторичные индексы реализованы в виде _B-деревьев_<br/>
Думая об индексах, можно представить указатели в конце книги, содержащие ключевые слова и номера страниц<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 31_

## Репликация
В MongoDB репликация базы данных обеспеивается с помощью так называемой топологии _набора реплик_.<br/>
Распределение идет по набору реплик для обеспечения избыточности и отработки отказа<br/>
Набор будет состоять из единственного первичного ключа и одного или более вторичных.<br/>
В случае отказа, происходит автоматический переход на резервный ресурс (кластер выбирает один из вторичных ресурсов и делает его новым первичным)<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 32_

## Скорость записи vs Долговечность
Под _скоростью записи_ понимается совокупный объем операций вставки, обноления и даления, которые база данных способна обработать в единицу времени<br/>
Под _долговечность_ понимается мера уверенности в том, что результат операций записи сохранится (к примеру, при неожиданном выключении питания)<br/>
ПО умолчнаию, в MongoDB используется принцип "выстрелил и забыл", где ответ от базы данных не требуется.<br/>
Если запрос принципиально важный, операцию можно выполнить в _безопасном режиме_ (который поддерживается всеми драйверами). В этом случае, клиент будет ждать ответ от сервера. Можно настроить еще ожидание репликации на n-серверов<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 33_

## Журналирование
В версии 2.0 по умолчанию включено журналирование.<br/>
В этом режиме, каждая операция фиксируется в журнале, допускающем только дозапись в конец (для скорости)<br/>
При неожиданной остановке, журнал позволит серверу MongoDB восстановить согласованное состояние файлов данных<br/>
Журналирование можно отлючить, чтобы повысить производительность, но в случае чего, файлы могут быть повреждены<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 33-34_

## Масштабирование
_Вертикальное масштабирование_ - улучшение оборудования<br/>
_Горизонтальное масштабирование_ - распределение по нескольким узлам<br/>
MongoDB изначально спроектирована в расчете на горизонтальное масштабирование. Для этого используется механизм сегментирования (sharding) по диапазонам, _автосегментирование (auto-sharding), который автоматически управляет распределение данных между узлами.<br/>
Каждый сегмент состоит из набора реплик.<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 35-36_

## Сервер MongoDB
Исполняемый файл сервера БД - `mongod` (или `mongodb.exe` для Windows)<br/>
С клиентом сервер взаимодействует по специальному протоколу через сетевой сокет.<br/>
Используемые файлы хранятся в `/data/db` (или в `C:\data\db` в Windows)

### Режимы работы сервера
Самый употребительный режим работы сервера MongoDB - _член набора реплик_ (конфигурируется набор, состоящий из 2 реплик и процесса-арбитра на третьем сервере)<br/>
В режиме _автосегментирования_ процессы `mongod` в каждом сегменте конфигурируются как наборы реплик, а "сбоку" находятся специальные серверы метаданных (конфигурационные серверы). `mongos` использется маршрутный сервер.<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 37_

## JavaScript-оболочка
Командная оболочка MongoDB - инструмент для администрирования базы данных с помощью языка JavaScript<br/>
Исполняемый файл `mongo` устанавливает соединение с указанным процессом `mongod` и запускает оболочку<br/>
Пример выбора базы данных, вставки объекта и поиска всех объектов
```js
> use mongodb-in-action
> db.users.insert({name: "Kyle"})
> db.users.find()
```
_Кайл Бенкер. MongoDB в действии. Стр. 38_

## Первичный ключ
В любом документе должен быть первичный ключ, хранящийся в поле `_id`.<br/>
Разрешается задвать `_id` самостоятельно при условии, что гарантирется его уникальность.<br/>
Если поле `_id` опустить, MongoDB присвоит объекту идентификатор самостоятельно<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 38_

## Представление документа в различных драйверах
У Python - словарь<br/>
У Java - специальный класс, реализующий `LinkedHashMap`<br/>
_Кайл Бенкер. MongoDB в действии. Стр. 39_

## Команды-утилиты
* `mongodump`/`mongorestore` - резервное копирвоание и восстановление, используя внутренний формат BSON8
* `mongoexport`/`mongoimport` - экспорт и импорт в JSON, CSV, TSV
* `mongosniff` - анализатор протокол для просмотра команд. По сути транслирует передаваемые команды в BSON в понятные человеку команды оболочки
* `mongostat` - аналог iostat для сборка статистики, включая число операций вставки, выборки, обновления, удаления, объем памяти и прочее

_Кайл Бенкер. MongoDB в действии. Стр. 40_
